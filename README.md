# NYPC 코드배틀 예선 후기

**[문제 규칙 및 링크](https://nypc.github.io/2025-codebattle/online_1)**


## 문제 소개
NYPC CodeBattle의 예선이 종료되었다.  
내가 생각한 전략과 코드를 남기는 것이 좋다고 판단하여 GitHub에 업로드하게 되었다.  

이 문제는 **Yacht Dice**라는 게임을 변형한 것이다.  
최적 전략을 찾는 방법은 각 경우의 수를 그래프로 나타내고, 그래프에 있는 정점마다 기대값을 구해서 가장 높은 것을 선택하는 것이다.

---

### 상태 공간 분석
이 게임은 **이전의 선택이 이후의 결과에 영향을 미치기 때문에 이전의 선택을 고려**해야한다.  

- 보너스 조건:  
  - 63,000점 이상을 얻은 경우 **보너스 점수 35,000점** 추가
  - 점수는 `0~63` 범위로 저장 (63점 초과는 63으로 처리)
  - 각각의 점수는 /1000을 해서 '0~63' 범위로 저장한다.

- 선택 가능한 카테고리 수:  
  - 총 12개의 카테고리로 이루어져 있으므로 선택 가능한 경우의 수는 2^12

- 이전 라운드에서 넘겨온 주사위 5개의 조합:
  -  ![Image](https://github.com/user-attachments/assets/cad77fda-e2dd-4e68-8a7c-20abc95914e7)

- 가능한 상태 수:
  - 2^12 × 64 × 252 = 66060288
---

### 상태 줄이기 (가지치기)
단순히 계산하면 상태가 너무 많지만, **도달 불가능한 상태는 제거**할 수 있다.

예시:
- 상단 카테고리에서 `One`, `Two`만 사용됐다면 63점 이상은 불가능 → 해당 상태 제거
- 실제로 계산하면 전체 4096개의 경우 중 **약 2794개 상태**만 도달 가능 → 약 **31% 절감**
- 추가적으로 보너스 점수 35,000점을 기대할 수 없는 상태도 제거 가능: 
  - 예를 들어 상단 6개 카테고리 모두 사용되었다면 0부터 63까지의 합이 가능하지만 더 이상 35000점이라는 보너스 점수를
    기대하지 못 해 0 ~ 63을 0이라고 표시해도 무방.
  - 또한 상단 카테고리에서 `One`, `Four`, `Five`만 사용되었다면 선택할 수 있는 나머지 상단 카테고리인 `Two`, `Three`, 'Six'는  
    최대 55점만 가능하기 때문에 `One`, `Four`, `Five`의 가능한 합인 0 1 2 3 4 5 6 7는 **63000**이상이 불가능하기 때문에 다 0
    이라고 표시해도 무방.

> 즉, 불필요한 상태를 걸러내면 훨씬 적은 상태만 계산하면 된다.

---

### 기대값 계산 방법
![Image](https://github.com/user-attachments/assets/00959530-e34c-4dec-b5ac-7737a4867311)  
각 상태는 이전 라운드에서 넘어온 5개의 주사위 조합과 합 그리고 선택한 카테고리 정보를 가지고 있다.  
또한 5개의 주사위를 던져서 나올 수 있는 252개의 조합의 경우가 있다. 

각 상태의 기대값을 구하는 과정:
1. 이전 라운드에서 넘어온 5개의 주사위 조합과 이번 라운드에 던져서 나온 5개의 주사위 조합을 합친
   10개의 주사위 조합을 만듬
2. 10개의 주사위 조합에서 5개를 선택하고 상용하지 않은 카테고리에 점수를 기록했을 때의 점수와 그 다음 상태의 잠재값을 더함
3. 모든 가능한 경우에서 **가장 높은 기댓값**을 선택
4. 주사위를 던져 각 5개의 주사위 조합이 나올 확률과, 그 결과 상태에서 구한 최대 기대값을 곱해 모두 더한다

---

### 실행 결과
- 모든 상태의 기대값을 구하는 데 대략적으로 **약 1시간 반** 소요됨
- 가지치기 및 효율화 덕분에, 단순 계산 대비 훨씬 빠르게 결과를 얻을 수 있었음

---

### 양자화
- 구한 상태값들의 용량이 문제에서 제시한 용량보다 커서 줄일 필요
- 문제 규칙을 보면 ×1000을 하니 1000미만 값은 필요없다 판단하고 /1000을 해서 저장
- 따라서 각 값에 대한 용량을 1byte 수준으로 만듬
- 그 다음 나온 상태값을 압축하여 10MiB미만으로 하는 데에 성공

---

### 문제점
- 위와 같은 방식은 충분히 효율적이지만 2인 게임에서의 승리 확률을 극대화하지 않는다.
- 예를 들어 상대방하고 점수차가 40000점이라고 하고 남은 카테고리는 `CHANCE`과 `YACHT`라고 하고 1 1 1 2 2를 선택했다고 하자
- 그러면 이 경우 점수를 극대화 할려면 `YACHT`를 선택하고 그 뒤에 `CHANCE`를 선택해야 하지만 이길 확률을 극대화 하기 위해서는
  `CHANCE`를 선택하고 그 뒤에 `YACHT`를 선택하여야 한다.
- 따라서 위의 최적 전략은 1인 게임에서는 적합하지만 2인 게임에서는 적합하지 않다.

---

## 개선 방법
2인 플레이시 최적 전략을 위와 같은 방식으로 구할려고 하면 저장해야 하는 정보량이 너무 크기 때문에 비현실적이다.   

각 상태에서 자신과 상대방의 점수표 상태와 두 사람의 현재 점수 차이를 모두 기록해야 하기 때문이다. 도달 가능한 상태만을 고려하면 줄어들긴 하지만  
그럼에도 불구하고 여전히 요구되는 장보량은 상당하므로, 다른 접근법이 필요하다.
